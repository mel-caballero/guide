<div id="card" class="card">
  <div class="card-header text-center">
    <h2>Contraste de color</h2>
  </div>
  <div class="card-body">
    <h3>Contenido textual</h3>
    <p>El texto normal (tamaño inferior a 18 puntos o a 14 puntos y negrita) y el texto normal en imágenes deben tener un contraste respecto al color de fondo de al menos 4.5:1.</p>
    <p>El texto grande (tamaño superior a 18 puntos o a 14 puntos y negrita) y el texto grande en imágenes deben tener un contraste respecto al color de fondo de al menos 3:1.</p>
    <p>Los enlaces no se deben diferenciar del texto que los rodea únicamente mediante el color o al menos tienen un contraste de 3:1 con el texto que los rodea y se deben emplear pistas visuales adicionales cuando reciben el foco.</p>
    <h3>Contenido no textual</h3>
    <p>Se debe asegurar un ratio mínimo de contraste de al menos 3:1 en los colores adyacentes de:</p>
    <ul>
      <li>Componentes de la interfaz de usuario: la información visual necesaria para identificar los componentes de la interfaz de usuario y los estados.</li>
      <li>Objetos gráficos: todas las partes de los gráficos que sean necesarias para comprender el contenido.</li>
    </ul>
    <h3>Calculadora de contraste</h3>
    <div class="row">
      <div class="col-3 px-3 row">
        <label for="texto" class="col-6 form-label">Color texto</label>
        <input type="color" class="col form-control form-control-color" id="texto" value="#000000">
      </div>
      <div class="col-3 px-3 row">
        <label for="fondo" class="col-6 form-label">Color fondo</label>
        <input type="color" class="col form-control form-control-color" id="fondo" value="#FFFFFF">
      </div>
      <div class="col-3 text-center">
        <p id="muestra" class="py-2 mx-3 border border-dark rounded">Muestra</p>
      </div>
      <div id="ratio" class="col-3 text-center py-2">
      </div>
    </div>
    <div id="result" class="row"></div>
    <h3>Calculadora de contraste para enlaces</h3>
    <div class="row">
      <div class="col-3 px-3 row">
        <label for="fcolor" class="col-6 form-label">Texto</label>
        <input type="color" class="col form-control form-control-color" id="fcolor" value="#000000">
      </div>
      <div class="col-3 px-3 row">
        <label for="bcolor" class="col-6 form-label">Fondo</label>
        <input type="color" class="col form-control form-control-color" id="bcolor" value="#FFFFFF">
      </div>
      <div class="col-3 px-3 row">
        <label for="lcolor" class="col-6 form-label">Enlace</label>
        <input type="color" class="col form-control form-control-color" id="lcolor" value="#3333FF">
      </div>
      <div class="col-3 text-center">
        <p id="muestraEnlace" class="py-2 mx-3 border border-dark rounded">Lorem ipsum <a href="">enlace</a> elit.</p>
      </div>
    </div>
    <div id="resultLink" class="row"></div>
  </div>
</div>

<script>
  $(document).ready(function() {
    contrastCheck();
    linkContrastChecker();

    $('#texto').on('input change', contrastCheck);
    $('#fondo').on('input change', contrastCheck);


    $('#fcolor').on('input change', linkContrastChecker);
    $('#bcolor').on('input change', linkContrastChecker);
    $('#lcolor').on('input change', linkContrastChecker);
  });

  function contrastCheck() {
    var texto = document.getElementById("texto").value;
    var fondo = document.getElementById("fondo").value;
    fetch('https://webaim.org/resources/contrastchecker/?fcolor=' + texto.slice(1) + '&bcolor=' + fondo.slice(1) + '&api')
      .then(response => response.json())
      .then(json => resultContrastCheck(json))
      .catch(err => console.log('Solicitud fallida', err));
    updateMuestra(texto, fondo);
  }

  function updateMuestra(texto, fondo) {
    $('#muestra').css('background-color', fondo);
    $('#muestra').css('color', texto);
  }

  function resultContrastCheck (json) {
    $('#ratio').empty();
    $('#result').empty();

    $('#ratio').append('<p>Ratio : ' + json.ratio + '</p>');

    $('#result').append('<div class="col-6"><p>AA Normal : ' + result(json.AA) + '</p><p>AA Grande : ' + result(json.AALarge) + '</p></div>');
    $('#result').append('<div class="col-6"><p>AAA Normal : ' + result(json.AAA) + '</p><p>AAA Grande : ' + result(json.AAALarge) + '</p></div>');
  }
  
  function linkContrastChecker() {
    var fcolor = document.getElementById("fcolor").value;
    var bcolor = document.getElementById("bcolor").value;
    var lcolor = document.getElementById("lcolor").value;
    fetch('https://webaim.org/resources/linkcontrastchecker/?fcolor=' + fcolor.slice(1) + '&bcolor=' + bcolor.slice(1) + '&lcolor=' + lcolor.slice(1) + '&api')
      .then(response => response.json())
      .then(json => resultContrastCheckLink(json))
      .catch(err => console.log('Solicitud fallida', err));
    updateMuestraLink(fcolor, bcolor, lcolor);
  }

  function updateMuestraLink(fcolor, bcolor, lcolor) {
    $('#muestraEnlace').css('background-color', bcolor);
    $('#muestraEnlace').css('color', fcolor);
    $('#muestraEnlace a').css('color', lcolor);
  }

  function resultContrastCheckLink (json) {
    $('#resultLink').empty();
    let changeName = (obj) => {
      for (let i in obj) {
        switch (i) {
            case 'Link to Body Text':
              $('#resultLink').append('<div class="row"><p class="col-6">Enlace con texto : ' + result(obj[i].conformance) + '</p><p class="col-6"> Ratio : ' + obj[i].ratio + '</p></div>')
            break;
            
            case 'Link to Background':
              
            $('#resultLink').append('<div class="row"><p class="col-6"> Enlace con el fondo : ' + result(obj[i].conformance) + '</p><p class="col-6"> Ratio : ' + obj[i].ratio + '</p></div>')
            break;
            case 'Body Text to Background':
              
            $('#resultLink').append('<div class="row"><p class="col-6">Texto con el fondo : ' + result(obj[i].conformance) + '</p><p class="col-6"> Ratio : ' + obj[i].ratio + '</p></div>')
            break;
          }
      }
    };
    changeName(json);
  }

  function result(res) {
    if(res == 'pass') {
      return 'Correcto <span style="color: green;">&#10003;</span>'
    } else {
      return 'Incorrecto <span style="color: red;">&#65794;</span'
    }
  }
</script>